sequenceDiagram
    participant Client as Client / Rights Holder
    participant V as Validator
    participant Chain as CometBFT Chain
    participant Ext as Off-Chain Verifier<br/>(payment processor,<br/>label, other chain)

    Client->>V: "run proof X for CID Y"<br/>(params: time range, etc.)

    V->>Chain: load proof script X (by CID)
    Chain-->>V: script source

    V->>Chain: query GrantAccess txs<br/>for CID Y in time range
    Chain-->>V: activity data

    rect rgb(239, 239, 255)
        Note over V: Goja Execution
        V->>V: execute prove(params)<br/>with mojave host API
        V->>V: compute result<br/>(total grants, unique consumers,<br/>by territory, etc.)
    end

    V->>V: sign attestation document<br/>with validator Ed25519 key

    V-->>Client: signed attestation<br/>(proof script CID, block height,<br/>result, validator signature)

    opt On-chain record
        V->>Chain: SubmitAttestation tx
    end

    Client->>Ext: present signed attestation

    rect rgb(211, 254, 232)
        Note over Ext: Verification
        Ext->>Ext: check validator signature<br/>against known validator set
        Ext->>Ext: read proof script from chain<br/>to understand what was proved
        Ext->>Ext: optionally re-run proof<br/>at same block height to verify
    end
