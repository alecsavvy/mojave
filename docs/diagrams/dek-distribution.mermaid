graph TD
    subgraph OnChain["On-Chain (always)"]
        UW[Uploader's Wrapped DEK<br/>wrapped to recovery X25519 key<br/>root of trust]
    end

    subgraph OffChain["Off-Chain — Validator Local Stores"]
        V1W[Validator 1<br/>wrapped DEK]
        V2W[Validator 2<br/>wrapped DEK]
        V3W[Validator 3<br/>wrapped DEK]
    end

    subgraph DeviceScope["Device-Scoped — Ephemeral"]
        D1W[Device A<br/>wrapped DEK<br/>expires block 1000]
        D2W[Device B<br/>wrapped DEK<br/>permanent — purchased]
    end

    UP[Upload Validator] -->|wrap DEK for each<br/>validator X25519 pubkey| V1W
    UP -->|CometBFT reactor| V2W
    UP -->|CometBFT reactor| V3W

    UP -->|UploadComplete tx| UW

    V1W -->|on GrantAccess:<br/>wrap DEK to device X25519| D1W
    V2W -->|on GrantAccess:<br/>wrap DEK to device X25519| D2W

    UW -.->|RecoverDEKHolders<br/>last resort| V1W

    style OnChain fill:#922b21,color:#fff
    style OffChain fill:#1a5276,color:#fff
    style DeviceScope fill:#2d6a4f,color:#fff
