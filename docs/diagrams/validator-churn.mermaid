sequenceDiagram
    participant Owner as Content Owner
    participant Chain as CometBFT Chain
    participant Old as Departing Validator
    participant Remain as Remaining DEK Holders
    participant New as Replacement Validator

    Note over Old: Validator departs the active set

    Old->>Chain: unbonding begins

    rect rgb(60, 40, 40)
        Note over Old: Unbonding Period
        Note over Old: Malicious behavior during this<br/>window → bond is slashed
    end

    Owner->>Chain: UpdateDEKHolderSet tx<br/>(remove old, add new)

    Chain-->>Remain: DEK holder set updated event
    Chain-->>New: DEK holder set updated event

    Remain->>Remain: unwrap own DEK
    Remain->>Remain: wrap DEK for new validator X25519
    Remain->>New: send wrapped DEK<br/>via CometBFT reactor

    New->>New: store wrapped DEK locally

    Note over New: New validator can now<br/>issue GrantAccess

    opt Content owner wants cryptographic revocation
        Owner->>Chain: RotateDEK tx
        Note over Remain: Re-encrypt .tdf with fresh DEK<br/>Distribute new wrapped DEKs<br/>Re-seed new .tdf blob
        Note over Old: Old DEK is now useless —<br/>.tdf blob has been re-encrypted
    end
