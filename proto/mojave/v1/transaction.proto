syntax = "proto3";

package mojave.v1;

import "mojave/v1/kv.proto";
import "mojave/v1/token.proto";

option go_package = "github.com/alecsavvy/mojave/gen/mojave/v1";

message SignedTransaction {
  bytes signature = 1;
  bytes transaction = 2;
}

message Transaction {
  TransactionHeader header = 1;
  TransactionBody body = 2;
}

message TransactionHeader {
  string chain_id = 1;
  string nonce = 2;
  bytes from_pubkey = 3;
  bytes to_pubkey = 4;
  uint64 watt_limit = 5;
}

message TransactionBody {
  oneof body {
    KeyValueTransaction key_value = 1;
    TokenTransferTransaction token_transfer = 2;
  }
}

message TransactionResult {
  TransactionResultHeader header = 1;
  TransactionResultBody body = 2;
  TransactionResultError error = 3;
}

message TransactionResultHeader {
  string tx_hash = 1;
  uint64 block_height = 2;
  string chain_id = 3;
  string nonce = 4;
  uint64 watts_used = 5;
}

message TransactionResultBody {
  oneof body {
    KeyValueResult key_value = 1;
    TokenTransferResult token_transfer = 2;
  }
}

enum TransactionResultErrorCode {
  TRANSACTION_RESULT_ERROR_CODE_UNSPECIFIED = 0;
  TRANSACTION_RESULT_ERROR_CODE_INTERNAL = 1;
  TRANSACTION_RESULT_ERROR_CODE_INVALID_REQUEST = 2;
  TRANSACTION_RESULT_ERROR_CODE_INVALID_SIGNATURE = 3;
  TRANSACTION_RESULT_ERROR_CODE_INVALID_NONCE = 4;
  TRANSACTION_RESULT_ERROR_CODE_INVALID_WATT_LIMIT = 5;
}

message TransactionResultError {
  TransactionResultErrorCode code = 1;
  string log = 2;
}
